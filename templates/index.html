<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>TramR Start</title>

    <!-- Bootstrap -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="static/js/bootstrap.min.js"></script>
    <script>
      var delay = (function(){
        var timer = 0;
        return function(callback, ms){
          clearTimeout (timer);
          timer = setTimeout(callback, ms);
        };
      })();

      $(document).ready(function(){
        $('#haltestelle').keyup(function() {
            delay(function(){
              haltsearch('#haltestelle','#result_halt','result_halt');
            }, 400 );
        });
        $('#ziel').keyup(function() {
            delay(function(){
              haltsearch('#ziel','#result_ziel','result_ziel');
            }, 400 );
        });

      });

      $(document).delegate('.result_halt', 'click', function(){
        //var auswahl = $this().attr('data-id');
        alert('hey');
        $('.result_halt').remove();
      });

      function haltsearch(string_id,result_id,result_class) {
          $.post('/abfrage', {
              haltstring: '%'+$(string_id).val()+'%'
          }).done(function(daten) {
              $('.'+result_class).remove();
              $.each(daten,function(i,item){
                  item.forEach(function(element){
                    $(result_id).append('<div class="panel-body '+result_class+'"  data-id="'+element[0]+'">'+element[1]+'</div>');
                  });
              });
          }).fail(function() {
              $(result_id).text("Error");
          });

      }
    </script>

  </head>

  <body>
    <div class="container">

      <div class="jumbotron">
        <h1 id="test">Hello TramR!</h1>
        <p>Nie. Mehr. Rennen. :-)</p>
      </div>

      <div class="row">
 				<div class="col-sm-12">

        </div>
			</div>

      <div class="row">
				<div class="col-sm-5">
          <div class="panel panel-info" id="result_halt">
            <div class="panel-heading" >
              <form>
                <label for="haltestelle">Gib hier Deine Haltestelle ein:</label>
                <div class="input-group">
                  <input type="text" class="form-control input-lg" id="haltestelle" placeholder="z.B. Hinterguggisberg Post">
                </div>
              </form>
            </div>

          </div>
 			 	</div><!--col-->

        <div class="col-sm-5">
          <div class="panel panel-default" id="result_ziel">
            <div class="panel-heading">
              <label for="ziel">Was ist die Endhaltestelle?</label>
              <div class="input-group">
                <input type="text" class="form-control input-lg" id="ziel" placeholder="z.B. Niedertupfikon Heumatt">
              </div>
            </div>

          </div>
        </div>

        <div class="col-sm-2">
          <div class="panel panel-default">
            <div class="panel-heading">
              <label for="zeit">Wegzeit (Min.):</label>
              <div class="input-group">
                <input type="text" class="form-control input-lg" id="zeit" placeholder="3:45">
              </div>
            </div>
          </div>
        </div><!--col-->

    </div><!--container-->
  </body>

</html>
